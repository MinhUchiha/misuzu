<%= javascript_include_tag 'event' %>
<%= javascript_include_tag 'resource/ja' %>

<%= form_for :user, url: custom_events_path  do |f| %>
<div class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><%= link_to 'メニュー', main_path %></li>
      <!-- <li><a href="#">基準情報</a></li> -->
      <!-- <li><a href="#">セキュリティ管理</a></li> -->
      <li class="active">カレンダー</li>
    </ol>
  </div>
</div>
<div class="row">
  <div class="col-md-2">
    <div class="btn-group" role="group" aria-label="...">
      <%= f.submit '勤務', class: 'btn btn-default', id:'kintai'%>
      <%= f.submit '経費', class: 'btn btn-default', id:'keihi'%>
    </div>
  </div>
  <div class="col-md-2 col-md-offset-3">
    <h3><span class="label label-default">氏名：　<%= Shainmaster.find(session[:selected_shain]).try :氏名 %></span></h3>
  </div>
  <div class="col-md-2 col-md-offset-3" align="right">
    <div class="btn-group" role="group" aria-label="...">
      <%= f.submit '帰宅', class: 'btn btn-default', id:'kitaku-button'%>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-2 col-md-offset-5">
    <h4><%= Shainmaster.find(session[:selected_shain]).yakushokumaster.try :役職名 %></h4>
  </div>

  <div class="col-md-1 col-md-offset-1">
    <%# button_to '社員選択', %>
    <button type="button" class="btn btn-default" id="search_user">社員選択</button>
  </div>
  
</div>

<div class="row">
  <div class="col-md-12">
    <div class="spacer">
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12">

    <table id="event_table" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">
      <thead>
      <tr>
        <th></th>
        <th>開始時刻</th>
        <th>終了時刻</th>
        <th>状態</th>
        <th>場所</th>
        <th>JOB No.</th>
        <th>工程名</th>
        <th>工数</th>
        <th>計上</th>
      </tr>
      </thead>

      <tbody>
      <% @events.each do |event| %>
          <tr>
            <td><%= event.id %></td>
            <td><%= event.開始 %></td>
            <td><%= event.終了 %></td>
            <td><%= event.joutaimaster.try :name %></td>
            <!--<td><%= event.shozai.try :所在名 %></td>-->
            <!--<td><%# event.場所名 %></td>-->
            <% 
               if event.bashomaster
                 basho_name = event.bashomaster.name
                 basho_name = event.bashomaster.kaisha_name if event.bashomaster.場所区分 == '2' 
               end
            %>
            <td><%= basho_name %></td>
            <td><%= event.JOB %></td>
            <td><%= event.kouteimaster.try :工程名 %></td>
            <td><%= event.工数 %></td>
            <td><%= event.計上 %></td>
            <!--<td><%# event.joutaimaster.状態名 %></td>-->
          </tr>
      <% end %>


      <%# @events.each do |event| %>
      <%# render partial: 'table_row', locals: {event: event} %>
      <%# end %>
      </tbody>
    </table>
  </div>

</div>

<div class="row">
  <div class="col-md-2">
    <%= link_to "新規イベント", new_event_path %>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="spacer">
    </div>
  </div>
</div>

<legend></legend>

<div class="row">
  <div class="col-md-2">
    <div class="input-group">
      <input type='text' class="form-control" id="goto-date-input" name="goto-date-input">
      <span class="input-group-btn">
        <button class="btn btn-default" type="button" id="toggle-calendar-goto">
          <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
        </button>
      </span>
    </div>
  </div>
  <div class="col-md-1">
    <button id="goto-date-button" class="btn btn-default" type="button">Go!</button>
  </div>
  <div class="col-md-2 col-md-offset-2" align="right">
    <div class="btn-group" role="group" aria-label="...">
      <button id="month-view" type="button" class="btn btn-default">月</button>
      <button id="day-view" type="button" class="btn btn-default">日</button>
    </div>
  </div>
</div>

<div class="spacer"></div>
<div class="row">
  <div class="col-md-12">
    <div id="calendar-month-view"></div>
    <div id="calendar-timeline"></div>
  </div>
</div>

    <%# render 'select_user_modal' %>
    <div class="modal fade" id="select_user_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">社員選択</h4>
          </div>
          <div class="modal-body">
            <%# Render the new person form (passing modal => true to enable remote => true) %>

            <table id="user_table" class="table table-striped table-bordered table-hover" cellspacing="0">
              <thead>
              <tr>
                <th>社員番号</th>
                <th>氏名</th>
              </tr>
              </thead>

              <tbody>
              <% @shains.each do |shain| %>
                  <tr>
                    <td><%= shain.連携用社員番号 %></td>
                    <td><%= shain.氏名 %></td>
                  </tr>
              <% end %>
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <%= f.submit '　ＯＫ　', class: 'btn btn-default', id:'koutei_sentaku_ok'%>
            <button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
          </div>
        </div>
      </div>
    </div>
    <input type="hidden" name="selected_user" id="selected_user"/>
    <input type="hidden" name="selected_user_name" id="selected_user_name"/>
<% end %>
